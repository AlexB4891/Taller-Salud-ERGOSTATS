---
title: "Fortaleciendo el an√°lisis espacial de acceso a salud"
subtitle: "De los datos al diagn√≥stico y la acci√≥n"
author: 
  - "Pablo Sarango"
  - "Alex Baja√±a"
format: 
  revealjs:
    logo: ergos--02.png
    css: estilos.css
    title-slide-attributes:
      data-background-image: grafi.png
      data-background-size: expand
      data-background-opacity: "0.5"
    width: 1280
    height: 720
    slide-number: true
    theme: solarized
editor: visual
execute: 
  eval: false
  echo: true
---


## El Centro de Investigaci√≥n Estad√≠stica ERGOSTATS 

### Misi√≥n de ERGOSTATS:

Fund√© ERGOSTATS con la misi√≥n de construir una comunidad en torno a las tecnolog√≠as Open Source, impulsando una sociedad orientada por datos.

### ¬øPor qu√© el an√°lisis de datos?

El an√°lisis de datos y su aplicaci√≥n deben ser derechos universales, no un privilegio. La educaci√≥n en an√°lisis de datos ayuda a entender problemas desde su ra√≠z y a tomar decisiones informadas.

### ¬øQue nos espera en 2025?

Nuestra visi√≥n para 2025 es fortalecer esta comunidad, promoviendo un marco √©tico y comunitario donde el an√°lisis de datos sea accesible y fomente el desarrollo.

## Actividades de ERGOSTATS en 2024 

-   [3]{style="font-size: 1.5em; font-weight: bold; color: #800080; "} cursos realizados
-   [4]{style="font-size: 1.5em; font-weight: bold; color: #800080; "} webinars impartidos
-   [3]{style="font-size: 1.5em; font-weight: bold; color: #800080;"} taller de capacitaci√≥n interna
-   [+50]{style="font-size: 1.5em; font-weight: bold; color: #800080;"} publicaciones de car√°cter estad√≠stico y de divulgaci√≥n

Colaboraciones importantes:

-   Escuela P√≥litecnica Nacional
-   Prefectura de la provincia de Manab√≠
-   Red Ecuatoriana de Ciencia Regional

# Agenda

## Tres puntos para la colaboraci√≥n interinstitucional:

1.  üìç Indicador de accesibilidad a los servicios de salud, "Una cr√≠tica a la configuraci√≥n del SNS"
2.   üåê El Sistema Integrado de Indicadores Espaciales de la EPN "Acercando los datos a la academia"
3.   üéì ERGOSTATS Academia "Capacitaci√≥n con contenido relevante en colaboraci√≥n con INEC"

# Indicador de accesibilidad a los servicios de salud

Propuesta de investigaci√≥n colaborativa

## Sobre la importancia del acceso a la salud

"The capability to avoid premature mortality, or to escape preventable morbidity, is a basic part of the freedom that we have reason to value." ‚Äî *Amartya Sen, Development as Freedom (1999), p. 36*

"Resulta indispensable mejorar el funcionamiento y gesti√≥n de las instituciones p√∫blicas del sector de salud de manera que respondan a las necesidades cl√≠nicas y no cl√≠nicas de la poblaci√≥n. La correcta implementaci√≥n del Modelo de Atenci√≥n Integral en Salud y particularmente, de la Red P√∫blica Integral a nivel nacional y local es prioritaria para delinear la correcta oferta de servicios en el primer, segundo y tercer nivel de atenci√≥n."

‚Äî *C√≥digo Org√°nico de la Salud, 2016*

## El SNS

En Ecuador, el Sistema Nacional de Salud (SNS) se organiza en tres niveles de atenci√≥n:

-   Primer nivel: Principalmente centros de salud
-   Segundo nivel: Centros de especialidades
-   Tercer nivel: Unidades de alta especilidad

> Entre los niveles 1 y 2, se atienden el 95% de problemas sanitarios del pa√≠s.

## **üìä La organizaci√≥n territorial del SNS**

-   El Sistema Nacional de Salud (SNS) en Ecuador se estructura sobre la base de **zonas, distritos y circuitos** de salud, bajo el principio de **atenci√≥n integral y territorializada**.

-   Sin embargo, en la pr√°ctica, la **disponibilidad y distribuci√≥n de los servicios especializados** sigue siendo desigual entre √°reas urbanas, periurbanas y rurales.

-   A pesar de avances, m√°s del **30 % de la poblaci√≥n rural** enfrenta dificultades para acceder a servicios de salud oportuna y resolutiva (INEC, 2021).

    > üîç *¬øRealmente todos acceden a los servicios que necesitan, cuando y donde los necesitan?*

## **üåê Desigualdades territoriales y accesibilidad**

\
üìâ *Acceso ‚â† Presencia f√≠sica del establecimiento*

-   Tener un centro de salud cercano **no garantiza el acceso efectivo**: importa la oferta de servicios, el tiempo de desplazamiento, la congesti√≥n y la capacidad resolutiva.

-   En provincias como Morona Santiago o Esmeraldas, los tiempos promedio de traslado superan los **60 minutos** para acceder al segundo nivel de atenci√≥n (MSP, 2023).

    > üìç *Medir d√≥nde est√°n los servicios ya no es suficiente: necesitamos saber qui√©nes realmente pueden llegar a ellos.*


## Alternativas {.scrollable .smaller}

| M√©todo | Descripci√≥n | Ventajas | Limitaciones |
|------------------|------------------|------------------|------------------|
| **1. PAI (Provider-to-Area Ratio)** | Raz√≥n simple entre n√∫mero de proveedores en un √°rea y la poblaci√≥n en esa misma √°rea. | Muy f√°cil de calcular. | Ignora distancia, movilidad y oferta externa. |
| **2. Gravity Model** | Calcula la accesibilidad ponderando oferta y demanda seg√∫n distancia o tiempo, usando una funci√≥n de impedancia. | Considera distancia y competencia por servicios. | Requiere calibraci√≥n del par√°metro de distancia. |
| **3. Two-Step Floating Catchment Area (2SFCA)** | Eval√∫a cobertura considerando relaciones entre proveedores y poblaci√≥n dentro de √°reas de captaci√≥n (buffers). | Balancea oferta y demanda local. Sencillo y flexible. | Usa l√≠mites binarios de accesibilidad (dentro/fuera del buffer). |
| **4. Enhanced 2SFCA (E2SFCA)** | Variante del 2SFCA que introduce un **decay function** para ponderar la accesibilidad seg√∫n distancia dentro del √°rea de captaci√≥n. | M√°s realista al modelar ca√≠da del acceso con la distancia. | Requiere elegir forma y par√°metros del decaimiento. |
| **5. Modified 2SFCA (M2SFCA)** | Integra mejoras como buffers m√∫ltiples, congesti√≥n por demanda y tipos de servicios diferenciados. | Aumenta precisi√≥n y especificidad. | M√°s complejo de implementar. |
| **6. Kernel Density 2SFCA (KD2SFCA)** | Sustituye buffers fijos por una funci√≥n kernel (suavizado) que modela la influencia de los proveedores de forma continua. | M√°s fiel a los patrones reales de accesibilidad. | Alta carga computacional y par√°metros a calibrar. |

## Un m√©todo para el SNS

El m√©todo E2SFCA (Enhanced Two-Step Floating Catchment Area) es una herramienta geoespacial avanzada que permite evaluar la accesibilidad espacial a servicios de salud.

> -   La **pol√≠tica p√∫blica necesita herramientas para identificar brechas reales de acceso** y tomar decisiones informadas sobre asignaci√≥n de recursos, planificaci√≥n y mejora del sistema.
>
> -   **Identificaci√≥n precisa de √°reas con acceso limitado a atenci√≥n primaria:** El E2SFCA permite detectar zonas donde la poblaci√≥n tiene dificultades para acceder a servicios de salud de primer nivel, considerando tanto la disponibilidad de profesionales como la distancia geogr√°fica.

## ¬øPor qu√© aplicar el m√©todo E2SFCA en Ecuador?

-   **Consideraci√≥n del efecto de la distancia en el acceso a servicios:** Este m√©todo incorpora el concepto de "decadencia de distancia", reconociendo que la probabilidad de utilizar un servicio disminuye a medida que aumenta la distancia o el tiempo de viaje.

-   **Apoyo a la planificaci√≥n y distribuci√≥n equitativa de recursos:** Al identificar √°reas con baja accesibilidad, las autoridades pueden tomar decisiones informadas sobre la ubicaci√≥n de nuevos centros de salud o la asignaci√≥n de recursos, promoviendo la equidad en el acceso a la atenci√≥n m√©dica.

## ¬øPor qu√© aplicar el m√©todo E2SFCA en Ecuador?

-   **Evaluaci√≥n de la efectividad de pol√≠ticas de salud:** El E2SFCA puede utilizarse para monitorear y evaluar el impacto de intervenciones y pol√≠ticas destinadas a mejorar la accesibilidad a servicios de salud en diferentes regiones.

-   **Facilitaci√≥n de an√°lisis comparativos entre regiones:** Permite comparar la accesibilidad a servicios de salud entre diferentes √°reas geogr√°ficas, identificando disparidades y orientando estrategias de mejora.

## Mapa de Quito

```{r eval=TRUE, echo = FALSE}


library(tidyverse)
library(sf)

# Cargar y preparar los datos de zonas censales
zonas <- st_read("../data/GEODATABASE_NACIONAL_2021/GEODATABASE_NACIONAL_2021.gdb/", layer = "zon_a", quiet = TRUE) %>% 
  st_as_sf()

dmq_zonas <- zonas %>% dplyr::filter(str_detect(zon, "^170150"))

centroides_dmq <- st_centroid(dmq_zonas) %>% 
  st_transform(4326)



dmq_zonas %>% 
  ggplot() +
  geom_sf(fill = "darkblue",alpha = 0.2) +
  geom_sf(data = centroides_dmq, size = 0.5, color = "red") +
  theme_minimal() +
  labs(title = "Zonas Censales del Distrito Metropolitano de Quito",
       subtitle = "Fuente: GEODATABASE NACIONAL 2021")
```



## Isocrona para una zona censal

```{r echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}


isocrona <- st_read("../data/shp/isocronas/170150010.shp", quiet = TRUE)

target <- dmq_zonas %>% 
  filter(str_detect(zon, "^170150010") )

isocrona %>% 
  ggplot() +
  geom_sf(data = dmq_zonas, fill = "grey") + 
  geom_sf(aes(fill = name), alpha = 0.2) +
  geom_sf(data = target, fill = "darkblue", alpha = 0.5) +
  theme_minimal() +
  theme(legend.position = "bottom", 
        legend.title = element_blank()) +
  labs(title = "Isocrona para el zona censal 170150010",
       caption = "Fuente: HERE API")
  

```
## Obtener las ubicaciones de los hospitales en el DMQ

Para obtener las ubicaciones de los hospitales realizamos una consulta a la API de OSM.

```{r echo=FALSE, eval=FALSE, message=FALSE, warning=FALSE}

hospitales_sf <- 
  # Obtenemos la zona de donde queremos consultar
  getbb("Quito Ecuador") %>% 
  
  # Creamos la consulta 
  opq() %>% 
  
  # Especificamos las caracteristicas deseadas de OSM
  add_osm_feature(key = "amenity",
                  value = "hospital") %>% 
  
  # Especificamos el formato de salida de los datos como sf
  osmdata_sf()
```

> Aqui tenemos la primera dificultad t√©cnica. OSM es de car√°cter p√∫blico y colaborativo, no dispone de actualizaciones ni contempla la totalidad del SNS. Por otro lado con esta fuente no se puede estimar la oferta de m√©dicos. 

## Hospitales del DMQ

```{r echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}

hospitales <- st_read("../data/shp/hospitales.shp", quiet = TRUE)


dmq_zonas %>% 
  ggplot() +
  geom_sf(fill = "gray", alpha = 0.2) +
  geom_sf(data = hospitales, color = "darkblue", size = 2) +
  theme_minimal() +
  labs(title = "Hospitales en el Distrito Metropolitano de Quito",
       caption = "Fuente: OpenStreetMap") 

```

## Visualizar la matriz de influencia {.scrollable .smaller}

```{r echo=FALSE, eval=TRUE}
# Visualizar la matriz de influencia

matriz_completa <- st_read("../data/gpkg/matriz_influencia.gpkg",
                            layer = "matriz_influencia")

matriz_completa %>% 
  as_tibble() %>% 
  select(-geom) %>% 
  slice(1:10) %>% 
  select(1:10) %>% 
  gt::gt() %>% 
  gt::tab_header(
    title = "Matriz de influencia de hospitales en el DMQ",
    subtitle = "Primeras 10 filas y columnas"
  ) 
```

## Insumos por construir

### Matriz de ponderaciones o pesos

Buscamos explicar c√≥mo asignar importancia relativa a distintos elementos de la red o territorio analizado.


## Funci√≥n de distancia (impedancia)

Crear la funci√≥n de impedancia para asignar los pesos correspondientes a los hospitales en base a la distancia.

> **Muy importante:** Identificaci√≥n de todas las unidades de salud -> Georreferenciaci√≥n -> Integraci√≥n de objetos espaciales al Registro Administrativo.

## √çndice de acceso espacial (IAE)

### Paso 1
Para cada ubicaci√≥n de m√©dicos $j$, se buscan todas las ubicaciones de poblaci√≥n $k$ que se encuentren dentro de un tiempo de viaje umbral ($d_0$) desde la ubicaci√≥n $j$ (es decir, esta es el √°rea de captaci√≥n de la ubicaci√≥n $j$), y se calcula la raz√≥n m√©dico-poblaci√≥n $R_j$ dentro del √°rea de captaci√≥n:

$$
R_j = \frac{S_j}{\sum_{k \in \{d_{kj} \leq d_0\}} P_k}
$$

## √çndice de acceso espacial (IAE)

donde:\

-   $P_k$ es la poblaci√≥n en la ubicaci√≥n $k$ cuyo centroide cae dentro del √°rea de captaci√≥n $j$ ($d_{kj} \leq d_0$),\
-   $S_j$ es el n√∫mero de m√©dicos en la ubicaci√≥n $j$,\
-   $d_{kj}$ es el tiempo de viaje entre $k$ y $j$.

## √çndice de acceso espacial (IAE)

### Paso 2:

Para cada ubicaci√≥n de poblaci√≥n $i$, se buscan todas las ubicaciones de m√©dicos $j$ que se encuentren dentro del tiempo de viaje umbral ($d_0$) desde la ubicaci√≥n $i$ (es decir, esta es el √°rea de captaci√≥n del punto de poblaci√≥n $i$), y se suman las razones m√©dico-poblaci√≥n $R_j$ (calculadas en el paso 1) en esas ubicaciones:

$$
A_i^F = \sum_{j \in \{d_{ij} \leq d_0\}} R_j = \sum_{j \in \{d_{ij} \leq d_0\}} \frac{S_j}{\sum_{k \in \{d_{kj} \leq d_0\}} P_k}
$$

## √çndice de acceso espacial (IAE)

Donde:

-   $A_i^F$ representa la accesibilidad de la poblaci√≥n en la ubicaci√≥n $i$ a m√©dicos, basada en el m√©todo de √°reas de captaci√≥n flotante en dos pasos.\
-   $R_j$ es la raz√≥n m√©dico-poblaci√≥n en la ubicaci√≥n del m√©dico $j$, cuyo centroide se encuentra dentro del √°rea de captaci√≥n centrada en la poblaci√≥n $i$ (es decir, $d_{ij} \leq d_0$),\
-   $d_{ij}$ es el tiempo de viaje entre $i$ y $j$.

## √çndice de acceso espacial (IAE)

### Interpretaci√≥n

Un valor m√°s alto de $A_i^F$ indica un mejor acceso a m√©dicos desde esa ubicaci√≥n poblacional.

> El primer paso asigna una raz√≥n inicial a cada √°rea de captaci√≥n (o √°rea de servicio) centrada en las ubicaciones de los m√©dicos, y el segundo paso suma esas razones iniciales en las √°reas de captaci√≥n superpuestas donde los residentes tienen acceso a m√∫ltiples ubicaciones m√©dicas.

Este valor se genera para cada uno de los sectores censales y puede interpretarse como que **cuanto mayor sea la puntuaci√≥n, m√°s acceso tiene ese sector censal a un proveedor de salud.**

## Coeficiente de acceso espacial (CAE)

### Normalizaci√≥n e interpretaci√≥n

Sin embargo, el valor del IAE es **dif√≠cil de interpretar y requiere que conozcamos la distribuci√≥n de el indicador en una regi√≥n**. Para poder interpretar el indicador se normaliza los valores IAE dividi√©ndolos por el valor IAE medio de toda la regi√≥n.

Los valores CAE tambi√©n indican el rango, de modo que **si un sector censal tiene un CAE m√°s alto que otro sector censal, entonces el sector censal con el valor CAE m√°s alto tiene mayor acceso a un proveedor m√©dico**.

## Coeficiente de acceso espacial (CAE)

![](indicador_diagrama.png){fig-align="center"}

## Un primer ejercicio

### Supuestos

-   La poblaci√≥n de cada zona censal es determinada por el Censo de Poblaci√≥n y Vivienda 2022
-   El n√∫mero de doctores en cada hospital lo hemos asumido con una distribuci√≥n uniforme entre 10 y 20 doctores por hospital.
-   El n√∫mero de hospitales en cada zona censal es determinado por la matriz de influencia creada anteriormente (OSM DATA).

## Un primer ejercicio

### Limitaciones

-   La matriz de influencia no considera la capacidad resolutiva de cada hospital.
-   El registro administrativo de Recursos y Actividades de Salud no dispone de informaci√≥n para poder identificar el hospital.

## Indice de acceso espacial (IAE)

```{r echo=FALSE, eval=TRUE, warning=FALSE, message=FALSE}

indice <- st_read("../data/gpkg/iae_dmq.gpkg", quiet = TRUE)

indice %>% 
  ggplot() +
  geom_sf(aes(fill = indice_acceso_espacial)) +
  scale_fill_viridis_c() +
  labs(title = "Indice de Acceso Espacial (IAE) en el DMQ",
       fill = "IAE") +
  theme_minimal()

```

## Coeficiente de acceso espacial (CAE)

```{r echo=FALSE, eval=TRUE, warning=FALSE, message=FALSE}

indice %>% 
  mutate(coef_acceso_espacial = indice_acceso_espacial / mean(indice_acceso_espacial, na.rm = TRUE)) %>% 
  ggplot() +
  geom_sf(aes(fill = coef_acceso_espacial)) +
 scale_fill_gradient2(
    low = "blue",     # color for low values
    mid = "white",    # color at midpoint
    high = "red",     # color for high values
    midpoint = 1      # the value that corresponds to "mid"
  ) +
  labs(title = "Coeficiente de Acceso Espacial (CAE) en el DMQ",
       fill = "CAE") +
  theme_minimal() 

```

## Siguientes pasos

-   Aplicar el m√©todo E2SFCA para calcular el acceso a servicios de salud en otras regiones del pa√≠s.
-   Solicitar al INEC acceso a la informaci√≥n sin anonimizaci√≥n para poder depurar el resultado **dentro de un contexto de investigaci√≥n colaborativa**
-   Explorar la posibilidad de integrar otros indicadores de salud y servicios para enriquecer el an√°lisis.
-   Contrastar los resultados con datos administrativos y encuestas de salud para validar las conclusiones.

# El Sistema Integrado de Indicadores Espaciales de la EPN

Acercando los datos a la academia

## El procesamiento de datos

```{mermaid eval = TRUE}
timeline
    title Evoluci√≥n del SIIG
    2014 : Germen en INEC
    2019 : Prototipo en STECSDI
    2023 : Versi√≥n acad√©mica EPN-ERGOSTATS
    2025 : Propuesta de reintegraci√≥n INEC
```


# ¬øPor qu√© un convenio?


**Objetivo**  

- Unificar RA desde la fuente + Censo + cartograf√≠a oficial para un dashboard nacional de amenidades.
- Homologaci√≥n e integraci√≥n de diversas fuentes.
- Publicaciones peri√≥dicas y alimentaci√≥n conjunta de indicadores


**Necesitamos**  

* FTP / API seguro  
* Metadatos compatibles  
* Frecuencia determinada por el calendario estad√≠stico

> Fuentes disponibles: ENEMDU, AMIE, REEM, Senescyt, RAS, Inclusi√≥n financiera


## Seguridad & gobernanza 

:::: {.columns}

::: {.column width="45%"}
**INEC gana**  

‚úî Indicadores espaciales listos  
‚úî Visibilidad institucional  
‚úî Formaci√≥n interna  
‚úî Co-autor√≠a papers/herramientas

:::

::: {.column width="45%"}
**Academia gana**  

‚úî Datos oficiales  
‚úî Validaci√≥n metodol√≥gica  
‚úî Difusi√≥n conjunta  
‚úî Sustentabilidad SIIG

:::


::::




# Nido del B√∫ho ‚Äì Capacitaci√≥n conjunta

## Malla piloto

- **M√≥d. 1** Fundamentos de an√°lisis espacial (R).  
- **M√≥d. 2** Modelamiento espacial teor√≠a y pr√°ctica.  
- **M√≥d. 3** Recomendaciones de pol√≠tica basadas en evidencia.

> La malla se realiz√≥ en colaboraci√≥n con RECIR. Se busca a√±adir involucrados que puedan potenciar los objetivos de aprendizaje de los estudiantes. 

## Ruta de implementaci√≥n

| Fase              | Mes 2025 | Acci√≥n clave                                     | Rol INEC                         |
|-------------------|----------|--------------------------------------------------|----------------------------------|
| Taller interno    | Agosto     | Curso 20 h, tarifa colaboraci√≥n (-50 %)          | Participar y brindar feedback    |
| Revisi√≥n material | Septiembre      | Ajustes seg√∫n retroalimentaci√≥n                  | Validar contenido y ejercicios   |
| Versi√≥n p√∫blica   | Octubre      | Lanzamiento a estudiantes externos               | Co-docencia y difusi√≥n conjunta  |


## Condiciones de colaboraci√≥n

- Acceso a datos INEC para casos pr√°cticos.  
- Material y c√≥digo con licencia **CC-BY-SA** + **coautor√≠a INEC**.  
- Inclusi√≥n de gu√≠as, slides y repositorio reproducible.


## Resultados esperados

- **Gu√≠a de an√°lisis espacial** y slides actualizados.  
- Indicador implementado como estudio de caso oficial.  
- Talleres y webinars conjuntos para difundir hallazgos.

# Gracias por su atenci√≥n

